{
  "_comment": "This file is generated. Please edit .homeycompose/app.json instead.",
  "id": "se.cohen.keba",
  "version": "1.1.13",
  "compatibility": ">=5.0.0",
  "sdk": 3,
  "brandColor": "#53ad31",
  "platforms": [
    "local"
  ],
  "name": {
    "en": "Keba"
  },
  "description": {
    "en": "Automation by Innovation."
  },
  "tags": {
    "en": [
      "keba, P20, P30, battery, charging"
    ],
    "sv": [
      "keba, P20, P30, batteri, laddning"
    ]
  },
  "category": [
    "energy"
  ],
  "homeyCommunityTopicId": 68776,
  "permissions": [],
  "images": {
    "small": "/assets/images/small.png",
    "large": "/assets/images/large.png",
    "xlarge": "/assets/images/xlarge.png"
  },
  "author": {
    "name": "Jonathan Cohen"
  },
  "copyright": "Jonathan Cohen (jonathan@cohen.se)",
  "license": " GPL-3.0-or-later",
  "contributing": {
    "donate": {
      "paypal": {
        "username": "cohense"
      }
    }
  },
  "flow": {
    "triggers": [
      {
        "title": {
          "en": "Charge power changed",
          "sv": "Laddström ändrades"
        },
        "tokens": [
          {
            "name": "charge_power",
            "type": "number",
            "title": {
              "en": "Charge power",
              "sv": "Laddström"
            },
            "example": 6.5
          }
        ],
        "args": [
          {
            "name": "device",
            "type": "device",
            "filter": "driver_id=keba-p30"
          }
        ],
        "id": "charge_power_change"
      },
      {
        "title": {
          "en": "Charging stopped",
          "sv": "Laddning avslutad"
        },
        "args": [
          {
            "name": "device",
            "type": "device",
            "filter": "driver_id=keba-p30"
          }
        ],
        "id": "charge_status_false"
      },
      {
        "title": {
          "en": "Charging started",
          "sv": "Laddning startad"
        },
        "args": [
          {
            "name": "device",
            "type": "device",
            "filter": "driver_id=keba-p30"
          }
        ],
        "id": "charge_status_true"
      }
    ],
    "conditions": [
      {
        "title": {
          "en": "Charging !{{active|inactive}} ",
          "sv": "Laddning !{{aktiv|inaktiv}} "
        },
        "args": [
          {
            "name": "device",
            "type": "device",
            "filter": "driver_id=keba-p30"
          }
        ],
        "id": "is_charging"
      }
    ],
    "actions": [
      {
        "id": "set_charge_power",
        "title": {
          "en": "Set charge power",
          "sv": "Ställ laddström"
        },
        "titleFormatted": {
          "en": "Set charge power to [[charge_power]]",
          "sv": "Ställ laddström till [[charge_power]]"
        },
        "args": [
          {
            "name": "device",
            "type": "device",
            "filter": "driver_id=keba-p30"
          },
          {
            "type": "range",
            "name": "charge_power",
            "title": {
              "en": "Charge power",
              "sv": "Laddström"
            },
            "min": 6,
            "max": 63,
            "step": 0.5,
            "label": "A",
            "labelMultiplier": 1,
            "labelDecimals": 1
          }
        ]
      }
    ]
  },
  "drivers": [
    {
      "id": "keba-p30",
      "name": {
        "en": "Keba Charger",
        "sv": "Keba Laddbox"
      },
      "class": "other",
      "discovery": "keba-p30",
      "capabilities": [
        "onoff",
        "charge_power",
        "plug_status",
        "charge_status",
        "charge_power_selector",
        "measure_current_1",
        "measure_voltage_1",
        "measure_current_2",
        "measure_voltage_2",
        "measure_current_3",
        "measure_voltage_3",
        "measure_power",
        "measure_energy_current",
        "measure_energy_total"
      ],
      "capabilitiesOptions": {
        "onoff": {
          "title": {
            "en": "Turn on charger",
            "sv": "Slå på laddboxen"
          },
          "measure_power": {
            "approximated": true
          }
        }
      },
      "platforms": [
        "local"
      ],
      "connectivity": [
        "lan"
      ],
      "images": {
        "small": "/drivers/keba-p30/assets/images/small.png",
        "large": "/drivers/keba-p30/assets/images/large.png",
        "xlarge": "/drivers/keba-p30/assets/images/xlarge.png"
      },
      "pair": [
        {
          "id": "list_devices",
          "template": "list_devices",
          "navigation": {
            "next": "add_devices"
          },
          "options": {
            "singular": true
          }
        },
        {
          "id": "manual_pairing",
          "navigation": {
            "next": "add_devices"
          }
        },
        {
          "id": "add_devices",
          "template": "add_devices"
        }
      ],
      "settings": [
        {
          "id": "ip",
          "type": "text",
          "label": {
            "en": "IP address",
            "sv": "IP adress"
          },
          "value": "",
          "hint": {
            "en": "Enter IP address to the box.",
            "sv": "Ange IP adress till din box."
          }
        },
        {
          "id": "port",
          "type": "number",
          "label": {
            "en": "Port",
            "sv": "Port"
          },
          "value": 7090,
          "hint": {
            "en": "Enter port to the box, default is 7090.",
            "sv": "Ange port till din box, standard är 7090."
          }
        },
        {
          "id": "discovery",
          "type": "checkbox",
          "label": {
            "en": "Use Discovery",
            "sv": "Använd discovery"
          },
          "value": true,
          "hint": {
            "en": "If use discovery, the IP and Port will be updated based on MAC address.",
            "sv": "Om discovery används så kommer IP och Port uppdateras automatiskt baserat på MAC adress."
          }
        }
      ]
    }
  ],
  "capabilities": {
    "charge_power": {
      "type": "number",
      "decimals": 1,
      "title": {
        "en": "Charge power",
        "sv": "Laddström"
      },
      "units": "A",
      "getable": true,
      "setable": false,
      "uiComponent": "sensor",
      "icon": "assets/icons/power.svg",
      "insights": true
    },
    "charge_power_selector": {
      "type": "enum",
      "values": [
        {
          "id": "0",
          "title": {
            "en": "--- Sensor ---",
            "sv": "--- Sensor ---"
          }
        },
        {
          "id": "6000",
          "title": {
            "en": "6 A"
          }
        },
        {
          "id": "7000",
          "title": {
            "en": "7 A"
          }
        },
        {
          "id": "8000",
          "title": {
            "en": "8 A"
          }
        },
        {
          "id": "9000",
          "title": {
            "en": "9 A"
          }
        },
        {
          "id": "10000",
          "title": {
            "en": "10 A"
          }
        },
        {
          "id": "11000",
          "title": {
            "en": "11 A"
          }
        },
        {
          "id": "12000",
          "title": {
            "en": "12 A"
          }
        },
        {
          "id": "13000",
          "title": {
            "en": "13 A"
          }
        },
        {
          "id": "14000",
          "title": {
            "en": "14 A"
          }
        },
        {
          "id": "15000",
          "title": {
            "en": "15 A"
          }
        },
        {
          "id": "16000",
          "title": {
            "en": "16 A"
          }
        },
        {
          "id": "20000",
          "title": {
            "en": "20 A"
          }
        },
        {
          "id": "24000",
          "title": {
            "en": "24 A"
          }
        },
        {
          "id": "28000",
          "title": {
            "en": "28 A"
          }
        },
        {
          "id": "32000",
          "title": {
            "en": "32 A"
          }
        },
        {
          "id": "63000",
          "title": {
            "en": "63 A"
          }
        }
      ],
      "title": {
        "en": "Charge power",
        "sv": "Laddström"
      },
      "uiComponent": "picker",
      "getable": true,
      "setable": true
    },
    "charge_status": {
      "type": "boolean",
      "title": {
        "en": "Charging",
        "sv": "Laddar"
      },
      "getable": true,
      "setable": false,
      "uiComponent": "sensor",
      "icon": "assets/icons/chargingStatus.svg"
    },
    "measure_current_1": {
      "type": "number",
      "decimals": 2,
      "title": {
        "en": "Current Ph1",
        "sv": "Ström L1"
      },
      "units": "A",
      "getable": true,
      "setable": false,
      "uiComponent": "sensor",
      "icon": "assets/icons/power.svg",
      "insights": true
    },
    "measure_current_2": {
      "type": "number",
      "decimals": 2,
      "title": {
        "en": "Current Ph2",
        "sv": "Ström L2"
      },
      "units": "A",
      "getable": true,
      "setable": false,
      "uiComponent": "sensor",
      "icon": "assets/icons/power.svg",
      "insights": true
    },
    "measure_current_3": {
      "type": "number",
      "decimals": 2,
      "title": {
        "en": "Current Ph3",
        "sv": "Ström L3"
      },
      "units": "A",
      "getable": true,
      "setable": false,
      "uiComponent": "sensor",
      "icon": "assets/icons/power.svg",
      "insights": true
    },
    "measure_energy_current": {
      "type": "number",
      "decimals": 2,
      "title": {
        "en": "Current Energy",
        "sv": "Energi pågående laddning"
      },
      "units": "kWh",
      "getable": true,
      "setable": false,
      "uiComponent": "sensor",
      "icon": "assets/icons/energy.svg",
      "insights": true
    },
    "measure_energy_total": {
      "type": "number",
      "decimals": 2,
      "title": {
        "en": "Total Energy",
        "sv": "Energi Totalt"
      },
      "units": "kWh",
      "getable": true,
      "setable": false,
      "uiComponent": "sensor",
      "icon": "assets/icons/energy.svg",
      "insights": true
    },
    "measure_voltage_1": {
      "type": "number",
      "decimals": 0,
      "title": {
        "en": "Voltage Ph1",
        "sv": "Spänning L1"
      },
      "units": "V",
      "getable": true,
      "setable": false,
      "uiComponent": "sensor",
      "icon": "assets/icons/power.svg",
      "insights": true
    },
    "measure_voltage_2": {
      "type": "number",
      "decimals": 0,
      "title": {
        "en": "Voltage Ph2",
        "sv": "Spänning L2"
      },
      "units": "V",
      "getable": true,
      "setable": false,
      "uiComponent": "sensor",
      "icon": "assets/icons/power.svg",
      "insights": true
    },
    "measure_voltage_3": {
      "type": "number",
      "decimals": 0,
      "title": {
        "en": "Voltage Ph3",
        "sv": "Spänning L3"
      },
      "units": "V",
      "getable": true,
      "setable": false,
      "uiComponent": "sensor",
      "icon": "assets/icons/power.svg",
      "insights": true
    },
    "plug_status": {
      "type": "boolean",
      "title": {
        "en": "Plugged in",
        "sv": "Inkopplad"
      },
      "getable": true,
      "setable": false,
      "uiComponent": "sensor",
      "icon": "assets/icons/plugStatus.svg",
      "insights": true
    }
  },
  "discovery": {
    "keba-p30": {
      "type": "mac",
      "mac": {
        "manufacturer": [
          [
            0,
            7,
            128
          ],
          [
            0,
            96,
            181
          ],
          [
            136,
            107,
            15
          ],
          [
            132,
            46,
            20
          ],
          [
            204,
            134,
            236
          ]
        ]
      }
    }
  }
}
